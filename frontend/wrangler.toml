name = "modular-saas-platform"
compatibility_date = "2024-01-01"
compatibility_flags = ["nodejs_compat"]

# Cloudflare Account Configuration
account_id = "74ecde4d46d4b399c7295cf599d2886b"

# Zone Configuration
zone_id = "0bff66558872c58ed5b8b7942acc34d9"

[build]
command = "npm run build"
cwd = "."

[build.upload]
format = "modules"

# KV Namespaces for data storage
kv_namespaces = [
  {
    binding = "ADVANCIA_DATA",
    id = "3bdece1ca0824daeaaecaccfd220895c"
  }
]

# Email Routing Configuration
[email]
name = "advanciapayledger.com"
routes = [
  { pattern = "support@advanciapayledger.com", destination = "email-worker" },
  { pattern = "admin@advanciapayledger.com", destination = "email-worker" },
  { pattern = "ai@advanciapayledger.com", destination = "email-worker" },
  { pattern = "*@advanciapayledger.com", destination = "email-worker" }
]

# Durable Objects for AI state management
[[durable_objects.bindings]]
name = "AI_STATE"
class_name = "AIStateManager"
script_name = "ai-connector"

# Environment variables (set via wrangler secret put)
# These should NOT be committed to version control
# Example: wrangler secret put DATABASE_URL
# Example: wrangler secret put JWT_SECRET

# Pages configuration
pages_build_output_dir = "out"

# Production routes (for custom domain)
routes = [
  { pattern = "advanciapayledger.com/*", zone_name = "advanciapayledger.com" },
  { pattern = "www.advanciapayledger.com/*", zone_name = "advanciapayledger.com" }
]

# Development settings
[dev]
port = 3000
local_protocol = "http"

# Environment-specific overrides
[env.production]
name = "modular-saas-platform"
pages_build_output_dir = "out"
routes = [
  { pattern = "advanciapayledger.com/*", zone_name = "advanciapayledger.com" },
  { pattern = "www.advanciapayledger.com/*", zone_name = "advanciapayledger.com" }
]
[vars]
NEXT_PUBLIC_API_URL = "https://api.advanciapayledger.com"
NEXT_PUBLIC_SOCKET_URL = "https://api.advanciapayledger.com"
NODE_ENV = "production"

[env.preview]
name = "modular-saas-platform-preview"
pages_build_output_dir = "out"
[vars]
NEXT_PUBLIC_API_URL = "https://api.advanciapayledger.com"
NEXT_PUBLIC_SOCKET_URL = "https://api.advanciapayledger.com"
NODE_ENV = "production"