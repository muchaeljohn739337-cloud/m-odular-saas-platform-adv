// AI Core - Half Brain Cell System
// Add these models to your main schema.prisma file

// Workflow definitions - what the AI can do
model AIWorkflow {
  id              String              @id @default(uuid())
  name            String              @unique
  description     String
  category        String              // "automation", "monitoring", "code_suggestion", "data_collection", "orchestration"
  triggerType     String              // "event", "scheduled", "manual"
  cronSchedule    String?             // for scheduled triggers
  enabled         Boolean             @default(true)
  requiresApproval Boolean            @default(true) // critical tasks need human approval
  riskLevel       String              @default("medium") // "low", "medium", "high", "critical"
  aiModel         String              @default("gpt-4") // "gpt-4", "gpt-3.5-turbo", "claude-3"
  config          String              // JSON configuration
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt
  
  tasks           AITask[]
  executions      AIWorkflowExecution[]
  
  @@index([category])
  @@index([enabled])
  @@index([triggerType])
  @@map("ai_workflows")
}

// Task queue - individual units of work
model AITask {
  id              String              @id @default(uuid())
  workflowId      String
  workflow        AIWorkflow          @relation(fields: [workflowId], references: [id], onDelete: Cascade)
  executionId     String?
  execution       AIWorkflowExecution? @relation(fields: [executionId], references: [id], onDelete: SetNull)
  
  taskType        String              // "email", "report", "code_fix", "monitoring", "data_collection"
  priority        Int                 @default(5) // 1-10, higher = more urgent
  status          String              @default("pending") // "pending", "in_progress", "awaiting_approval", "approved", "rejected", "completed", "failed"
  
  input           String              // JSON input data
  aiSuggestion    String?             // AI's proposed action/solution
  aiReasoning     String?             // Why AI suggests this
  aiConfidence    Decimal?            @default(0) // 0-1 confidence score
  
  output          String?             // Result after execution
  error           String?
  
  // Human feedback
  reviewedBy      String?
  reviewedAt      DateTime?
  approvalStatus  String?             // "approved", "rejected", "modified"
  humanFeedback   String?             // Learning data
  humanModification String?           // What human changed
  
  attempts        Int                 @default(0)
  maxRetries      Int                 @default(3)
  
  scheduledFor    DateTime?
  startedAt       DateTime?
  completedAt     DateTime?
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt
  
  @@index([workflowId])
  @@index([executionId])
  @@index([status])
  @@index([priority])
  @@index([taskType])
  @@index([scheduledFor])
  @@map("ai_tasks")
}

// Workflow execution tracking
model AIWorkflowExecution {
  id              String              @id @default(uuid())
  workflowId      String
  workflow        AIWorkflow          @relation(fields: [workflowId], references: [id], onDelete: Cascade)
  
  status          String              @default("running") // "running", "completed", "failed", "cancelled"
  triggeredBy     String              // "system", "user:{userId}", "event:{eventType}"
  triggerData     String?             // JSON data that triggered this
  
  tasksTotal      Int                 @default(0)
  tasksCompleted  Int                 @default(0)
  tasksFailed     Int                 @default(0)
  
  startedAt       DateTime            @default(now())
  completedAt     DateTime?
  duration        Int?                // milliseconds
  
  error           String?
  
  tasks           AITask[]
  
  @@index([workflowId])
  @@index([status])
  @@index([startedAt])
  @@map("ai_workflow_executions")
}

// AI learning database - feedback loop
model AILearning {
  id              String              @id @default(uuid())
  taskId          String              @unique
  
  taskType        String
  aiSuggestion    String              // What AI proposed
  humanDecision   String              // What human chose (approved/rejected/modified)
  humanModification String?           // What human changed
  feedback        String?             // Human's explanation
  
  wasCorrect      Boolean?            // Did AI suggestion work out?
  outcomeNotes    String?             // Post-execution notes
  
  context         String              // JSON - situational context
  patterns        String?             // JSON - identified patterns
  
  createdAt       DateTime            @default(now())
  
  @@index([taskType])
  @@index([humanDecision])
  @@index([wasCorrect])
  @@index([createdAt])
  @@map("ai_learning")
}

// System monitoring - AI watches for issues
model AIMonitoringAlert {
  id              String              @id @default(uuid())
  
  alertType       String              // "error", "downtime", "performance", "security", "anomaly"
  severity        String              // "info", "warning", "error", "critical"
  source          String              // where the issue was detected
  
  title           String
  description     String
  detectedBy      String              @default("ai_monitor") // "ai_monitor", "system", "user"
  
  aiAnalysis      String?             // AI's analysis of the issue
  aiSuggestion    String?             // AI's suggested fix
  aiConfidence    Decimal?            @default(0)
  
  status          String              @default("open") // "open", "investigating", "resolved", "false_positive"
  assignedTo      String?
  
  resolvedBy      String?
  resolvedAt      DateTime?
  resolution      String?             // How it was fixed
  
  metadata        String?             // JSON - additional data
  
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt
  
  @@index([alertType])
  @@index([severity])
  @@index([status])
  @@index([createdAt])
  @@map("ai_monitoring_alerts")
}

// AI suggestions for code/content/process improvements
model AISuggestion {
  id              String              @id @default(uuid())
  
  suggestionType  String              // "code_fix", "optimization", "content", "process", "security"
  category        String              // "bug_fix", "performance", "security", "best_practice", "refactor"
  
  title           String
  description     String
  aiReasoning     String              // Why AI suggests this
  confidence      Decimal             @default(0) // 0-1
  
  // For code suggestions
  filePath        String?
  lineNumber      Int?
  currentCode     String?
  suggestedCode   String?
  
  // For process/content suggestions
  currentProcess  String?
  suggestedProcess String?
  
  impact          String?             // Expected impact/benefit
  effort          String?             // Estimated effort (low/medium/high)
  
  status          String              @default("pending") // "pending", "reviewed", "accepted", "rejected", "implemented"
  reviewedBy      String?
  reviewedAt      DateTime?
  reviewNotes     String?
  
  implementedAt   DateTime?
  outcome         String?             // Post-implementation notes
  
  metadata        String?             // JSON
  
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt
  
  @@index([suggestionType])
  @@index([category])
  @@index([status])
  @@index([createdAt])
  @@map("ai_suggestions")
}

// AI-generated reports
model AIReport {
  id              String              @id @default(uuid())
  
  reportType      String              // "daily", "weekly", "monthly", "incident", "custom"
  category        String              // "usage", "performance", "security", "business", "technical"
  
  title           String
  summary         String              // Executive summary
  content         String              // Full report content (Markdown)
  
  format          String              @default("markdown") // "markdown", "json", "html"
  
  generatedBy     String              @default("ai_core") // "ai_core", "scheduled_job"
  aiModel         String              @default("gpt-4")
  
  // Data sources
  dataFrom        DateTime            // Period start
  dataTo          DateTime            // Period end
  dataSources     String              // JSON - what data was used
  
  // Insights and recommendations
  insights        String?             // JSON array of key insights
  recommendations String?             // JSON array of recommendations
  
  status          String              @default("generated") // "generated", "reviewed", "published", "archived"
  
  reviewedBy      String?
  reviewedAt      DateTime?
  publishedAt     DateTime?
  
  recipients      String?             // JSON array of who received this
  
  createdAt       DateTime            @default(now())
  
  @@index([reportType])
  @@index([category])
  @@index([status])
  @@index([createdAt])
  @@map("ai_reports")
}

// AI system configuration and settings
model AISystemConfig {
  id              String              @id @default(uuid())
  
  key             String              @unique // config key
  value           String              // config value (JSON)
  
  category        String              // "llm", "queue", "monitoring", "workflow", "learning"
  description     String
  
  isEncrypted     Boolean             @default(false)
  
  updatedBy       String?
  updatedAt       DateTime            @updatedAt
  createdAt       DateTime            @default(now())
  
  @@index([category])
  @@map("ai_system_config")
}
